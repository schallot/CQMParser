=============================================================================================================================================================================
Initial Population:
[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Diagnosis: Diabetes" using "Diabetes (2.16.840.1.113883.3.464.1003.103.12.1001)")] DiabetesDiagnosis
	    such that DiabetesDiagnosis.prevalencePeriod starts before 
	    end of EncounterWithHospitalization.hospitalizationPeriod
	  return EncounterWithHospitalization.encounter
	  union [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Medication, Administered: Hypoglycemics Treatment Medications" using "Hypoglycemics Treatment Medications (2.16.840.1.113762.1.4.1196.394)")] HypoglycemicMedication
	    such that if pointInTime is not null then Interval[pointInTime, pointInTime]
	  else if period is not null then period 
	  else null as Interval<DateTime> ( HypoglycemicMedication.relevantDatetime, HypoglycemicMedication.relevantPeriod ) starts during EncounterWithHospitalization.hospitalizationPeriod
	  return EncounterWithHospitalization.encounter
	  union [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab
	    such that BloodGlucoseLab.relevantDatetime during EncounterWithHospitalization.hospitalizationPeriod
	      and BloodGlucoseLab.result >= 200 'mg/dL'
	  return EncounterWithHospitalization.encounter
=============================================================================================================================================================================
Denominator:
[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Diagnosis: Diabetes" using "Diabetes (2.16.840.1.113883.3.464.1003.103.12.1001)")] DiabetesDiagnosis
	    such that DiabetesDiagnosis.prevalencePeriod starts before 
	    end of EncounterWithHospitalization.hospitalizationPeriod
	  return EncounterWithHospitalization.encounter
	  union [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Medication, Administered: Hypoglycemics Treatment Medications" using "Hypoglycemics Treatment Medications (2.16.840.1.113762.1.4.1196.394)")] HypoglycemicMedication
	    such that if pointInTime is not null then Interval[pointInTime, pointInTime]
	  else if period is not null then period 
	  else null as Interval<DateTime> ( HypoglycemicMedication.relevantDatetime, HypoglycemicMedication.relevantPeriod ) starts during EncounterWithHospitalization.hospitalizationPeriod
	  return EncounterWithHospitalization.encounter
	  union [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab
	    such that BloodGlucoseLab.relevantDatetime during EncounterWithHospitalization.hospitalizationPeriod
	      and BloodGlucoseLab.result >= 200 'mg/dL'
	  return EncounterWithHospitalization.encounter
=============================================================================================================================================================================
Denominator Exclusions:
None
=============================================================================================================================================================================
Numerator:
[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Diagnosis: Diabetes" using "Diabetes (2.16.840.1.113883.3.464.1003.103.12.1001)")] DiabetesDiagnosis
	    such that DiabetesDiagnosis.prevalencePeriod starts before 
	    end of EncounterWithHospitalization.hospitalizationPeriod
	  return EncounterWithHospitalization.encounter
	  union [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Medication, Administered: Hypoglycemics Treatment Medications" using "Hypoglycemics Treatment Medications (2.16.840.1.113762.1.4.1196.394)")] HypoglycemicMedication
	    such that if pointInTime is not null then Interval[pointInTime, pointInTime]
	  else if period is not null then period 
	  else null as Interval<DateTime> ( HypoglycemicMedication.relevantDatetime, HypoglycemicMedication.relevantPeriod ) starts during EncounterWithHospitalization.hospitalizationPeriod
	  return EncounterWithHospitalization.encounter
	  union [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab
	    such that BloodGlucoseLab.relevantDatetime during EncounterWithHospitalization.hospitalizationPeriod
	      and BloodGlucoseLab.result >= 200 'mg/dL'
	  return EncounterWithHospitalization.encounter PertinentEncounter
	  let period: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( PertinentEncounter ),
	  relevantPeriod: Interval[start of Period, Min({ 
	  end of Period, start of Period + 10 days }
	)](period)
	  return Tuple {
	    encounter: PertinentEncounter,
	    hospitalizationPeriod: period,
	    relevantPeriod: relevantPeriod,
	    relevantDays: ( ( expand { Interval[1, days between start of Period and 
	end of Period]} ) DayExpand
	  return 
	  end of DayExpand(Period)) DayIndex
	  let startPeriod: start of Period + ( 24 hours * ( DayIndex - 1 ) ),
	  endPeriod: if ( hours between startPeriod and 
	    end of Period < 24
	  ) then startPeriod 
	    else start of Period + ( 24 hours * DayIndex )
	  return Tuple {
	    dayIndex: DayIndex,
	    dayPeriod: Interval[startPeriod, endPeriod )
	  }(relevantPeriod)
	  } PertinentEncounterDays
	  return Tuple {
	    encounter: PertinentEncounterDays.encounter,
	    relevantPeriod: PertinentEncounterDays.relevantPeriod,
	    relevantDays: ( PertinentEncounterDays.relevantDays EncounterDay
	        return Tuple {
	          dayIndex: EncounterDay.dayIndex,
	          dayPeriod: EncounterDay.dayPeriod,
	          hasSevereResult: exists ( [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab1
	              where BloodGlucoseLab1.result > 300 'mg/dL'
	                and BloodGlucoseLab1.relevantDatetime during EncounterDay.dayPeriod
	          ),
	          hasElevatedResult: exists ( [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab2
	              where BloodGlucoseLab2.result >= 200 'mg/dL'
	                and BloodGlucoseLab2.relevantDatetime during EncounterDay.dayPeriod
	          ),
	          hasNoResult: not exists ( [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab3
	              where BloodGlucoseLab3.relevantDatetime during EncounterDay.dayPeriod
	          )
	        }
	    )
	  } EncounterWithResultDays
	  let eligibleEventDays: EncounterWithResultDays.relevantDays EncounterDay
	    where EncounterDay.dayIndex > 1
	    return Tuple {
	      dayIndex: EncounterDay.dayIndex,
	      dayPeriod: EncounterDay.dayPeriod,
	      hasHyperglycemicEvent: ( EncounterDay.hasSevereResult
	          or ( EncounterDay.hasNoResult
	              and EncounterWithResultDays.relevantDays[EncounterDay.dayIndex - 2].hasElevatedResult
	              and EncounterWithResultDays.relevantDays[EncounterDay.dayIndex - 3].hasElevatedResult
	          )
	      )
	    }
	  return Tuple {
	    encounter: EncounterWithResultDays.encounter,
	    relevantPeriod: EncounterWithResultDays.relevantPeriod,
	    eligibleEventDays: eligibleEventDays
	  } EncounterWithEventDays
	  where exists ( EncounterWithEventDays.eligibleEventDays EligibleEventDay
	      where EligibleEventDay.hasHyperglycemicEvent
	  )
	  return EncounterWithEventDays.encounter
=============================================================================================================================================================================
Numerator Exclusions:
None
=============================================================================================================================================================================
Measure Observation 1    :
Sum (
	  singleton from ( [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Diagnosis: Diabetes" using "Diabetes (2.16.840.1.113883.3.464.1003.103.12.1001)")] DiabetesDiagnosis
	    such that DiabetesDiagnosis.prevalencePeriod starts before 
	    end of EncounterWithHospitalization.hospitalizationPeriod
	  return EncounterWithHospitalization.encounter
	  union [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Medication, Administered: Hypoglycemics Treatment Medications" using "Hypoglycemics Treatment Medications (2.16.840.1.113762.1.4.1196.394)")] HypoglycemicMedication
	    such that if pointInTime is not null then Interval[pointInTime, pointInTime]
	  else if period is not null then period 
	  else null as Interval<DateTime> ( HypoglycemicMedication.relevantDatetime, HypoglycemicMedication.relevantPeriod ) starts during EncounterWithHospitalization.hospitalizationPeriod
	  return EncounterWithHospitalization.encounter
	  union [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab
	    such that BloodGlucoseLab.relevantDatetime during EncounterWithHospitalization.hospitalizationPeriod
	      and BloodGlucoseLab.result >= 200 'mg/dL'
	  return EncounterWithHospitalization.encounter PertinentEncounter
	  let period: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( PertinentEncounter ),
	  relevantPeriod: Interval[start of Period, Min({ 
	  end of Period, start of Period + 10 days }
	)](period)
	  return Tuple {
	    encounter: PertinentEncounter,
	    hospitalizationPeriod: period,
	    relevantPeriod: relevantPeriod,
	    relevantDays: ( ( expand { Interval[1, days between start of Period and 
	end of Period]} ) DayExpand
	  return 
	  end of DayExpand(Period)) DayIndex
	  let startPeriod: start of Period + ( 24 hours * ( DayIndex - 1 ) ),
	  endPeriod: if ( hours between startPeriod and 
	    end of Period < 24
	  ) then startPeriod 
	    else start of Period + ( 24 hours * DayIndex )
	  return Tuple {
	    dayIndex: DayIndex,
	    dayPeriod: Interval[startPeriod, endPeriod )
	  }(relevantPeriod)
	  } PertinentEncounterDays
	  return Tuple {
	    encounter: PertinentEncounterDays.encounter,
	    relevantPeriod: PertinentEncounterDays.relevantPeriod,
	    relevantDays: ( PertinentEncounterDays.relevantDays EncounterDay
	        return Tuple {
	          dayIndex: EncounterDay.dayIndex,
	          dayPeriod: EncounterDay.dayPeriod,
	          hasSevereResult: exists ( [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab1
	              where BloodGlucoseLab1.result > 300 'mg/dL'
	                and BloodGlucoseLab1.relevantDatetime during EncounterDay.dayPeriod
	          ),
	          hasElevatedResult: exists ( [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab2
	              where BloodGlucoseLab2.result >= 200 'mg/dL'
	                and BloodGlucoseLab2.relevantDatetime during EncounterDay.dayPeriod
	          ),
	          hasNoResult: not exists ( [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab3
	              where BloodGlucoseLab3.relevantDatetime during EncounterDay.dayPeriod
	          )
	        }
	    )
	  } EncounterWithResultDays
	  let eligibleEventDays: EncounterWithResultDays.relevantDays EncounterDay
	    where EncounterDay.dayIndex > 1
	    return Tuple {
	      dayIndex: EncounterDay.dayIndex,
	      dayPeriod: EncounterDay.dayPeriod,
	      hasHyperglycemicEvent: ( EncounterDay.hasSevereResult
	          or ( EncounterDay.hasNoResult
	              and EncounterWithResultDays.relevantDays[EncounterDay.dayIndex - 2].hasElevatedResult
	              and EncounterWithResultDays.relevantDays[EncounterDay.dayIndex - 3].hasElevatedResult
	          )
	      )
	    }
	  return Tuple {
	    encounter: EncounterWithResultDays.encounter,
	    relevantPeriod: EncounterWithResultDays.relevantPeriod,
	    eligibleEventDays: eligibleEventDays
	  } EncounterWithEventDays
	    where EncounterWithEventDays.encounter = QualifyingEncounter
	    return Count(EncounterWithEventDays.eligibleEventDays)
	)
	)
=============================================================================================================================================================================
Measure Observation 2    :
Count (
	  singleton from ( [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Diagnosis: Diabetes" using "Diabetes (2.16.840.1.113883.3.464.1003.103.12.1001)")] DiabetesDiagnosis
	    such that DiabetesDiagnosis.prevalencePeriod starts before 
	    end of EncounterWithHospitalization.hospitalizationPeriod
	  return EncounterWithHospitalization.encounter
	  union [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Medication, Administered: Hypoglycemics Treatment Medications" using "Hypoglycemics Treatment Medications (2.16.840.1.113762.1.4.1196.394)")] HypoglycemicMedication
	    such that if pointInTime is not null then Interval[pointInTime, pointInTime]
	  else if period is not null then period 
	  else null as Interval<DateTime> ( HypoglycemicMedication.relevantDatetime, HypoglycemicMedication.relevantPeriod ) starts during EncounterWithHospitalization.hospitalizationPeriod
	  return EncounterWithHospitalization.encounter
	  union [("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] InpatientEncounter
	  with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	    such that years between ToDate(BirthDateTime)and ToDate(AsOf) ( BirthDate.birthDatetime, start of Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( InpatientEncounter ) ) >= 18
	  where InpatientEncounter.relevantPeriod ends during Measurement Period QualifyingEncounter
	  return Tuple {
	    encounter: QualifyingEncounter,
	    hospitalizationPeriod: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( QualifyingEncounter )
	  } EncounterWithHospitalization
	  with [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab
	    such that BloodGlucoseLab.relevantDatetime during EncounterWithHospitalization.hospitalizationPeriod
	      and BloodGlucoseLab.result >= 200 'mg/dL'
	  return EncounterWithHospitalization.encounter PertinentEncounter
	  let period: Encounter Visit
		let ObsVisit: Last([("Encounter, Performed: Observation Services" using "Observation Services (2.16.840.1.113762.1.4.1111.143)")] LastObs
				where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
				sort by 
				end of relevantPeriod
		),
		VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
		EDVisit: Last([("Encounter, Performed: Emergency Department Visit" using "Emergency Department Visit (2.16.840.1.113883.3.117.1.7.1.292)")] LastED
				where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
				sort by 
				end of relevantPeriod
		)
		return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
		end of Visit.relevantPeriod] ( PertinentEncounter ),
	  relevantPeriod: Interval[start of Period, Min({ 
	  end of Period, start of Period + 10 days }
	)](period)
	  return Tuple {
	    encounter: PertinentEncounter,
	    hospitalizationPeriod: period,
	    relevantPeriod: relevantPeriod,
	    relevantDays: ( ( expand { Interval[1, days between start of Period and 
	end of Period]} ) DayExpand
	  return 
	  end of DayExpand(Period)) DayIndex
	  let startPeriod: start of Period + ( 24 hours * ( DayIndex - 1 ) ),
	  endPeriod: if ( hours between startPeriod and 
	    end of Period < 24
	  ) then startPeriod 
	    else start of Period + ( 24 hours * DayIndex )
	  return Tuple {
	    dayIndex: DayIndex,
	    dayPeriod: Interval[startPeriod, endPeriod )
	  }(relevantPeriod)
	  } PertinentEncounterDays
	  return Tuple {
	    encounter: PertinentEncounterDays.encounter,
	    relevantPeriod: PertinentEncounterDays.relevantPeriod,
	    relevantDays: ( PertinentEncounterDays.relevantDays EncounterDay
	        return Tuple {
	          dayIndex: EncounterDay.dayIndex,
	          dayPeriod: EncounterDay.dayPeriod,
	          hasSevereResult: exists ( [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab1
	              where BloodGlucoseLab1.result > 300 'mg/dL'
	                and BloodGlucoseLab1.relevantDatetime during EncounterDay.dayPeriod
	          ),
	          hasElevatedResult: exists ( [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab2
	              where BloodGlucoseLab2.result >= 200 'mg/dL'
	                and BloodGlucoseLab2.relevantDatetime during EncounterDay.dayPeriod
	          ),
	          hasNoResult: not exists ( [("Laboratory Test, Performed: Glucose lab test" using "Glucose lab test (2.16.840.1.113762.1.4.1045.134)")] BloodGlucoseLab3
	              where BloodGlucoseLab3.relevantDatetime during EncounterDay.dayPeriod
	          )
	        }
	    )
	  } EncounterWithResultDays
	  let eligibleEventDays: EncounterWithResultDays.relevantDays EncounterDay
	    where EncounterDay.dayIndex > 1
	    return Tuple {
	      dayIndex: EncounterDay.dayIndex,
	      dayPeriod: EncounterDay.dayPeriod,
	      hasHyperglycemicEvent: ( EncounterDay.hasSevereResult
	          or ( EncounterDay.hasNoResult
	              and EncounterWithResultDays.relevantDays[EncounterDay.dayIndex - 2].hasElevatedResult
	              and EncounterWithResultDays.relevantDays[EncounterDay.dayIndex - 3].hasElevatedResult
	          )
	      )
	    }
	  return Tuple {
	    encounter: EncounterWithResultDays.encounter,
	    relevantPeriod: EncounterWithResultDays.relevantPeriod,
	    eligibleEventDays: eligibleEventDays
	  } EncounterWithEventDays
	    where EncounterWithEventDays.encounter = QualifyingEncounter
	    return Count(EncounterWithEventDays.eligibleEventDays EligibleEventDay
	        where EligibleEventDay.hasHyperglycemicEvent
	    )
	)
	)
