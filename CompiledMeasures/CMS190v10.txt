=============================================================================================================================================================================
Initial Population:
VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  )
=============================================================================================================================================================================
Denominator:
VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  )
=============================================================================================================================================================================
Denominator Exclusions:
VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	  where Global.LengthInDays ( QualifyingEncounterICU.relevantPeriod ) < 2
	  union VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	  with ( //'SCIP' stands for Surgical Care Improvement Project
	[("Procedure, Performed: General Surgery" using "General Surgery (2.16.840.1.113883.3.117.1.7.1.255)")]
	  union [("Procedure, Performed: Gynecological Surgery" using "Gynecological Surgery (2.16.840.1.113883.3.117.1.7.1.257)")]
	  union [("Procedure, Performed: Hip Fracture Surgery" using "Hip Fracture Surgery (2.16.840.1.113883.3.117.1.7.1.258)")]
	  union [("Procedure, Performed: Hip Replacement Surgery" using "Hip Replacement Surgery (2.16.840.1.113883.3.117.1.7.1.259)")]
	  union [("Procedure, Performed: Intracranial Neurosurgery" using "Intracranial Neurosurgery (2.16.840.1.113883.3.117.1.7.1.260)")]
	  union [("Procedure, Performed: Knee Replacement Surgery" using "Knee Replacement Surgery (2.16.840.1.113883.3.117.1.7.1.261)")]
	  union [("Procedure, Performed: Urological Surgery" using "Urological Surgery (2.16.840.1.113883.3.117.1.7.1.272)")] Procedure
	    where Procedure.rank = 1 ) SelectedSCIPProcedure
	    such that Global.NormalizeInterval ( SelectedSCIPProcedure.relevantDatetime, SelectedSCIPProcedure.relevantPeriod ) ends during TJC.CalendarDayOfOrDayAfter ( VTE.StartOfFirstICU ( QualifyingEncounterICU ) )
	  union VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	  with [("Intervention, Order: Comfort Measures" using "Comfort Measures (1.3.6.1.4.1.33895.1.3.0.45)")]
	  union [("Intervention, Performed: Comfort Measures" using "Comfort Measures (1.3.6.1.4.1.33895.1.3.0.45)")] ComfortMeasures
	    such that Coalesce(start of Global.NormalizeInterval(ComfortMeasures.relevantDatetime, ComfortMeasures.relevantPeriod), ComfortMeasures.authorDatetime)during VTE.FromDayOfStartOfHospitalizationToDayAfterFirstICU ( QualifyingEncounterICU )
	  union from
	  VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU,
	  [("Procedure, Performed: General or Neuraxial Anesthesia" using "General or Neuraxial Anesthesia (2.16.840.1.113883.3.666.5.1743)")] AnesthesiaProcedure,
	  [("Intervention, Order: Comfort Measures" using "Comfort Measures (1.3.6.1.4.1.33895.1.3.0.45)")]
	  union [("Intervention, Performed: Comfort Measures" using "Comfort Measures (1.3.6.1.4.1.33895.1.3.0.45)")] ComfortMeasures
	  where Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) ends 1 day after day of VTE.StartOfFirstICU ( QualifyingEncounterICU )
	    and Coalesce(start of Global.NormalizeInterval(ComfortMeasures.relevantDatetime, ComfortMeasures.relevantPeriod), ComfortMeasures.authorDatetime)during TJC.CalendarDayOfOrDayAfter ( 
	    end of Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) )
	  return QualifyingEncounterICU
=============================================================================================================================================================================
Numerator:
( VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	    with ( [("Medication, Administered: Low Dose Unfractionated Heparin for VTE Prophylaxis" using "Low Dose Unfractionated Heparin for VTE Prophylaxis (2.16.840.1.113762.1.4.1045.39)")] VTEMedication
	    where VTEMedication.route in (valueset "Subcutaneous route" (2.16.840.1.113883.3.117.1.7.1.223))
	)
	  union [("Medication, Administered: Low Molecular Weight Heparin for VTE Prophylaxis" using "Low Molecular Weight Heparin for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.219)")]
	  union [("Medication, Administered: Injectable Factor Xa Inhibitor for VTE Prophylaxis" using "Injectable Factor Xa Inhibitor for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.211)")]
	  union [("Medication, Administered: Warfarin" using "Warfarin (2.16.840.1.113883.3.117.1.7.1.232)")]
	  union [("Medication, Administered: Rivaroxaban for VTE Prophylaxis" using "Rivaroxaban for VTE Prophylaxis (2.16.840.1.113762.1.4.1110.50)")]
	  union [("Device, Applied: Intermittent pneumatic compression devices (IPC)" using "Intermittent pneumatic compression devices (IPC) (2.16.840.1.113883.3.117.1.7.1.214)")]
	  union [("Device, Applied: Venous foot pumps (VFP)" using "Venous foot pumps (VFP) (2.16.840.1.113883.3.117.1.7.1.230)")]
	  union [("Device, Applied: Graduated compression stockings (GCS)" using "Graduated compression stockings (GCS) (2.16.840.1.113883.3.117.1.7.1.256)")] VTEProphylaxis
	      such that Global.NormalizeInterval ( VTEProphylaxis.relevantDatetime, VTEProphylaxis.relevantPeriod ) starts during TJC.CalendarDayOfOrDayAfter ( VTE.StartOfFirstICU ( QualifyingEncounterICU ) )
	)
	  union ( from
	      VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU,
	      [("Procedure, Performed: General or Neuraxial Anesthesia" using "General or Neuraxial Anesthesia (2.16.840.1.113883.3.666.5.1743)")] AnesthesiaProcedure,
	      ( [("Medication, Administered: Low Dose Unfractionated Heparin for VTE Prophylaxis" using "Low Dose Unfractionated Heparin for VTE Prophylaxis (2.16.840.1.113762.1.4.1045.39)")] VTEMedication
	    where VTEMedication.route in (valueset "Subcutaneous route" (2.16.840.1.113883.3.117.1.7.1.223))
	)
	  union [("Medication, Administered: Low Molecular Weight Heparin for VTE Prophylaxis" using "Low Molecular Weight Heparin for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.219)")]
	  union [("Medication, Administered: Injectable Factor Xa Inhibitor for VTE Prophylaxis" using "Injectable Factor Xa Inhibitor for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.211)")]
	  union [("Medication, Administered: Warfarin" using "Warfarin (2.16.840.1.113883.3.117.1.7.1.232)")]
	  union [("Medication, Administered: Rivaroxaban for VTE Prophylaxis" using "Rivaroxaban for VTE Prophylaxis (2.16.840.1.113762.1.4.1110.50)")]
	  union [("Device, Applied: Intermittent pneumatic compression devices (IPC)" using "Intermittent pneumatic compression devices (IPC) (2.16.840.1.113883.3.117.1.7.1.214)")]
	  union [("Device, Applied: Venous foot pumps (VFP)" using "Venous foot pumps (VFP) (2.16.840.1.113883.3.117.1.7.1.230)")]
	  union [("Device, Applied: Graduated compression stockings (GCS)" using "Graduated compression stockings (GCS) (2.16.840.1.113883.3.117.1.7.1.256)")] VTEProphylaxis
	      where Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) ends 1 day after day of VTE.StartOfFirstICU ( QualifyingEncounterICU )
	        and Global.NormalizeInterval ( VTEProphylaxis.relevantDatetime, VTEProphylaxis.relevantPeriod ) starts during TJC.CalendarDayOfOrDayAfter ( 
	        end of Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) )
	      return QualifyingEncounterICU
	  )
	  union ( ( VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	    with [("Medication, Administered: Oral Factor Xa Inhibitor for VTE Prophylaxis or VTE Treatment" using "Oral Factor Xa Inhibitor for VTE Prophylaxis or VTE Treatment (2.16.840.1.113883.3.117.1.7.1.134)")] FactorXaMedication
	      such that Global.NormalizeInterval ( FactorXaMedication.relevantDatetime, FactorXaMedication.relevantPeriod ) starts during TJC.CalendarDayOfOrDayAfter ( VTE.StartOfFirstICU ( QualifyingEncounterICU ) )
	)
	  union ( from
	      VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU,
	      [("Procedure, Performed: General or Neuraxial Anesthesia" using "General or Neuraxial Anesthesia (2.16.840.1.113883.3.666.5.1743)")] AnesthesiaProcedure,
	      [("Medication, Administered: Oral Factor Xa Inhibitor for VTE Prophylaxis or VTE Treatment" using "Oral Factor Xa Inhibitor for VTE Prophylaxis or VTE Treatment (2.16.840.1.113883.3.117.1.7.1.134)")] FactorXaMedication
	      where Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) ends 1 day after day of VTE.StartOfFirstICU ( QualifyingEncounterICU )
	        and Global.NormalizeInterval ( FactorXaMedication.relevantDatetime, FactorXaMedication.relevantPeriod ) starts during TJC.CalendarDayOfOrDayAfter ( 
	        end of Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) )
	      return QualifyingEncounterICU
	  )
	      intersect ( ( VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	    with [("Diagnosis: Atrial Fibrillation/Flutter" using "Atrial Fibrillation/Flutter (2.16.840.1.113883.3.117.1.7.1.202)")] AtrialFibrillation
	      such that AtrialFibrillation.prevalencePeriod starts on or before 
	      end of QualifyingEncounterICU.relevantPeriod
	)
	  union ( VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	      where exists ( QualifyingEncounterICU.diagnoses QualifyingEncounterDiagnoses
	          where QualifyingEncounterDiagnoses.code in (valueset "Atrial Fibrillation/Flutter" (2.16.840.1.113883.3.117.1.7.1.202))
	      )
	  )
	  union ( VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	      with [("Diagnosis: Venous Thromboembolism" using "Venous Thromboembolism (2.16.840.1.113883.3.117.1.7.1.279)")] VTEDiagnosis
	        such that VTEDiagnosis.prevalencePeriod starts before start of QualifyingEncounterICU.relevantPeriod
	  )
	          union VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	  with ( [("Procedure, Performed: Hip Replacement Surgery" using "Hip Replacement Surgery (2.16.840.1.113883.3.117.1.7.1.259)")]
	    union [("Procedure, Performed: Knee Replacement Surgery" using "Knee Replacement Surgery (2.16.840.1.113883.3.117.1.7.1.261)")] ) HipKneeProcedure
	    such that Global.NormalizeInterval ( HipKneeProcedure.relevantDatetime, HipKneeProcedure.relevantPeriod ) starts on or before 
	    end of QualifyingEncounterICU.relevantPeriod
	      )
	  )
	  union VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	  with 
	( [("Assessment, Performed: Risk for venous thromboembolism" using "Risk for venous thromboembolism (LOINC Code 72136-5)")] VTERiskAssessment
	    where VTERiskAssessment.result in (valueset "Low Risk" (2.16.840.1.113883.3.117.1.7.1.400))
	    return {
	      id: VTERiskAssessment.id,
	      LowRiskDatetime: Global.EarliestOf ( VTERiskAssessment.relevantDatetime, VTERiskAssessment.relevantPeriod )
	    }
	)
	  union ( [("Laboratory Test, Performed: INR" using "INR (2.16.840.1.113883.3.117.1.7.1.213)")] INRLabTest
	      where INRLabTest.result > 3.0
	      return {
	        id: INRLabTest.id,
	        LowRiskDatetime: INRLabTest.resultDatetime
	      }
	  )
	  union ( ( ( [("Medication, Administered: Unfractionated Heparin" using "Unfractionated Heparin (2.16.840.1.113883.3.117.1.7.1.218)")] UnfractionatedHeparin
	        where UnfractionatedHeparin.route in (valueset "Intravenous route" (2.16.840.1.113883.3.117.1.7.1.222))
	    )
	      union [("Medication, Administered: Direct Thrombin Inhibitor" using "Direct Thrombin Inhibitor (2.16.840.1.113883.3.117.1.7.1.205)")]
	      union [("Medication, Administered: Glycoprotein IIb/IIIa Inhibitors" using "Glycoprotein IIb/IIIa Inhibitors (2.16.840.1.113762.1.4.1045.41)")] ) AnticoagulantMedication
	      return {
	        id: AnticoagulantMedication.id,
	        LowRiskDatetime: start of Global.NormalizeInterval ( AnticoagulantMedication.relevantDatetime, AnticoagulantMedication.relevantPeriod )
	      }
	  ) LowRiskForVTE
	    such that LowRiskForVTE.LowRiskDatetime during VTE.FromDayOfStartOfHospitalizationToDayAfterFirstICU ( QualifyingEncounterICU )
	  union from
	  VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU,
	  [("Procedure, Performed: General or Neuraxial Anesthesia" using "General or Neuraxial Anesthesia (2.16.840.1.113883.3.666.5.1743)")] AnesthesiaProcedure,
	  
	( [("Assessment, Performed: Risk for venous thromboembolism" using "Risk for venous thromboembolism (LOINC Code 72136-5)")] VTERiskAssessment
	    where VTERiskAssessment.result in (valueset "Low Risk" (2.16.840.1.113883.3.117.1.7.1.400))
	    return {
	      id: VTERiskAssessment.id,
	      LowRiskDatetime: Global.EarliestOf ( VTERiskAssessment.relevantDatetime, VTERiskAssessment.relevantPeriod )
	    }
	)
	  union ( [("Laboratory Test, Performed: INR" using "INR (2.16.840.1.113883.3.117.1.7.1.213)")] INRLabTest
	      where INRLabTest.result > 3.0
	      return {
	        id: INRLabTest.id,
	        LowRiskDatetime: INRLabTest.resultDatetime
	      }
	  )
	  union ( ( ( [("Medication, Administered: Unfractionated Heparin" using "Unfractionated Heparin (2.16.840.1.113883.3.117.1.7.1.218)")] UnfractionatedHeparin
	        where UnfractionatedHeparin.route in (valueset "Intravenous route" (2.16.840.1.113883.3.117.1.7.1.222))
	    )
	      union [("Medication, Administered: Direct Thrombin Inhibitor" using "Direct Thrombin Inhibitor (2.16.840.1.113883.3.117.1.7.1.205)")]
	      union [("Medication, Administered: Glycoprotein IIb/IIIa Inhibitors" using "Glycoprotein IIb/IIIa Inhibitors (2.16.840.1.113762.1.4.1045.41)")] ) AnticoagulantMedication
	      return {
	        id: AnticoagulantMedication.id,
	        LowRiskDatetime: start of Global.NormalizeInterval ( AnticoagulantMedication.relevantDatetime, AnticoagulantMedication.relevantPeriod )
	      }
	  ) LowRiskForVTE
	  where Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) ends 1 day after day of VTE.StartOfFirstICU ( QualifyingEncounterICU )
	    and LowRiskForVTE.LowRiskDatetime during TJC.CalendarDayOfOrDayAfter ( 
	    end of Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) )
	  return QualifyingEncounterICU
	  union ( VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	  with [("Medication, Not Administered: Low Dose Unfractionated Heparin for VTE Prophylaxis" using "Low Dose Unfractionated Heparin for VTE Prophylaxis (2.16.840.1.113762.1.4.1045.39)")]
	  union [("Medication, Not Administered: Low Molecular Weight Heparin for VTE Prophylaxis" using "Low Molecular Weight Heparin for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.219)")]
	  union [("Medication, Not Administered: Injectable Factor Xa Inhibitor for VTE Prophylaxis" using "Injectable Factor Xa Inhibitor for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.211)")]
	  union [("Medication, Not Administered: Warfarin" using "Warfarin (2.16.840.1.113883.3.117.1.7.1.232)")]
	  union [("Medication, Not Administered: Rivaroxaban for VTE Prophylaxis" using "Rivaroxaban for VTE Prophylaxis (2.16.840.1.113762.1.4.1110.50)")]
	  union [("Medication, Not Ordered: Low Dose Unfractionated Heparin for VTE Prophylaxis" using "Low Dose Unfractionated Heparin for VTE Prophylaxis (2.16.840.1.113762.1.4.1045.39)")]
	  union [("Medication, Not Ordered: Low Molecular Weight Heparin for VTE Prophylaxis" using "Low Molecular Weight Heparin for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.219)")]
	  union [("Medication, Not Ordered: Injectable Factor Xa Inhibitor for VTE Prophylaxis" using "Injectable Factor Xa Inhibitor for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.211)")]
	  union [("Medication, Not Ordered: Warfarin" using "Warfarin (2.16.840.1.113883.3.117.1.7.1.232)")]
	  union [("Medication, Not Ordered: Rivaroxaban for VTE Prophylaxis" using "Rivaroxaban for VTE Prophylaxis (2.16.840.1.113762.1.4.1110.50)")] NoVTEMedicaion
	    such that NoVTEMedicaion.negationRationale in (valueset "Medical Reason" (2.16.840.1.113883.3.117.1.7.1.473))
	      and NoVTEMedicaion.authorDatetime during VTE.FromDayOfStartOfHospitalizationToDayAfterFirstICU ( QualifyingEncounterICU )
	    intersect VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	  with [("Device, Not Applied: Intermittent pneumatic compression devices (IPC)" using "Intermittent pneumatic compression devices (IPC) (2.16.840.1.113883.3.117.1.7.1.214)")]
	  union [("Device, Not Applied: Venous foot pumps (VFP)" using "Venous foot pumps (VFP) (2.16.840.1.113883.3.117.1.7.1.230)")]
	  union [("Device, Not Applied: Graduated compression stockings (GCS)" using "Graduated compression stockings (GCS) (2.16.840.1.113883.3.117.1.7.1.256)")]
	  union [("Device, Not Ordered: Intermittent pneumatic compression devices (IPC)" using "Intermittent pneumatic compression devices (IPC) (2.16.840.1.113883.3.117.1.7.1.214)")]
	  union [("Device, Not Ordered: Venous foot pumps (VFP)" using "Venous foot pumps (VFP) (2.16.840.1.113883.3.117.1.7.1.230)")]
	  union [("Device, Not Ordered: Graduated compression stockings (GCS)" using "Graduated compression stockings (GCS) (2.16.840.1.113883.3.117.1.7.1.256)")] NoVTEDevice
	    such that NoVTEDevice.negationRationale in (valueset "Medical Reason" (2.16.840.1.113883.3.117.1.7.1.473))
	      and NoVTEDevice.authorDatetime during VTE.FromDayOfStartOfHospitalizationToDayAfterFirstICU ( QualifyingEncounterICU )
	)
	  union ( from
	  VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU,
	  [("Procedure, Performed: General or Neuraxial Anesthesia" using "General or Neuraxial Anesthesia (2.16.840.1.113883.3.666.5.1743)")] AnesthesiaProcedure,
	  [("Medication, Not Administered: Low Dose Unfractionated Heparin for VTE Prophylaxis" using "Low Dose Unfractionated Heparin for VTE Prophylaxis (2.16.840.1.113762.1.4.1045.39)")]
	  union [("Medication, Not Administered: Low Molecular Weight Heparin for VTE Prophylaxis" using "Low Molecular Weight Heparin for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.219)")]
	  union [("Medication, Not Administered: Injectable Factor Xa Inhibitor for VTE Prophylaxis" using "Injectable Factor Xa Inhibitor for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.211)")]
	  union [("Medication, Not Administered: Warfarin" using "Warfarin (2.16.840.1.113883.3.117.1.7.1.232)")]
	  union [("Medication, Not Administered: Rivaroxaban for VTE Prophylaxis" using "Rivaroxaban for VTE Prophylaxis (2.16.840.1.113762.1.4.1110.50)")]
	  union [("Medication, Not Ordered: Low Dose Unfractionated Heparin for VTE Prophylaxis" using "Low Dose Unfractionated Heparin for VTE Prophylaxis (2.16.840.1.113762.1.4.1045.39)")]
	  union [("Medication, Not Ordered: Low Molecular Weight Heparin for VTE Prophylaxis" using "Low Molecular Weight Heparin for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.219)")]
	  union [("Medication, Not Ordered: Injectable Factor Xa Inhibitor for VTE Prophylaxis" using "Injectable Factor Xa Inhibitor for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.211)")]
	  union [("Medication, Not Ordered: Warfarin" using "Warfarin (2.16.840.1.113883.3.117.1.7.1.232)")]
	  union [("Medication, Not Ordered: Rivaroxaban for VTE Prophylaxis" using "Rivaroxaban for VTE Prophylaxis (2.16.840.1.113762.1.4.1110.50)")] NoVTEMedication
	  where NoVTEMedication.negationRationale in (valueset "Medical Reason" (2.16.840.1.113883.3.117.1.7.1.473))
	    and Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) ends 1 day after day of VTE.StartOfFirstICU ( QualifyingEncounterICU )
	    and NoVTEMedication.authorDatetime during TJC.CalendarDayOfOrDayAfter ( 
	    end of Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) )
	  return QualifyingEncounterICU
	      intersect from
	  VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU,
	  [("Procedure, Performed: General or Neuraxial Anesthesia" using "General or Neuraxial Anesthesia (2.16.840.1.113883.3.666.5.1743)")] AnesthesiaProcedure,
	  [("Device, Not Applied: Intermittent pneumatic compression devices (IPC)" using "Intermittent pneumatic compression devices (IPC) (2.16.840.1.113883.3.117.1.7.1.214)")]
	  union [("Device, Not Applied: Venous foot pumps (VFP)" using "Venous foot pumps (VFP) (2.16.840.1.113883.3.117.1.7.1.230)")]
	  union [("Device, Not Applied: Graduated compression stockings (GCS)" using "Graduated compression stockings (GCS) (2.16.840.1.113883.3.117.1.7.1.256)")]
	  union [("Device, Not Ordered: Intermittent pneumatic compression devices (IPC)" using "Intermittent pneumatic compression devices (IPC) (2.16.840.1.113883.3.117.1.7.1.214)")]
	  union [("Device, Not Ordered: Venous foot pumps (VFP)" using "Venous foot pumps (VFP) (2.16.840.1.113883.3.117.1.7.1.230)")]
	  union [("Device, Not Ordered: Graduated compression stockings (GCS)" using "Graduated compression stockings (GCS) (2.16.840.1.113883.3.117.1.7.1.256)")] NoVTEDevice
	  where NoVTEDevice.negationRationale in (valueset "Medical Reason" (2.16.840.1.113883.3.117.1.7.1.473))
	    and Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) ends 1 day after day of VTE.StartOfFirstICU ( QualifyingEncounterICU )
	    and NoVTEDevice.authorDatetime during TJC.CalendarDayOfOrDayAfter ( 
	    end of Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) )
	  return QualifyingEncounterICU
	  )
	  union VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	  with ( [("Medication, Not Administered: Low Dose Unfractionated Heparin for VTE Prophylaxis" using "Low Dose Unfractionated Heparin for VTE Prophylaxis (2.16.840.1.113762.1.4.1045.39)")]
	  union [("Medication, Not Administered: Low Molecular Weight Heparin for VTE Prophylaxis" using "Low Molecular Weight Heparin for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.219)")]
	  union [("Medication, Not Administered: Injectable Factor Xa Inhibitor for VTE Prophylaxis" using "Injectable Factor Xa Inhibitor for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.211)")]
	  union [("Medication, Not Administered: Warfarin" using "Warfarin (2.16.840.1.113883.3.117.1.7.1.232)")]
	  union [("Medication, Not Administered: Rivaroxaban for VTE Prophylaxis" using "Rivaroxaban for VTE Prophylaxis (2.16.840.1.113762.1.4.1110.50)")]
	  union [("Medication, Not Ordered: Low Dose Unfractionated Heparin for VTE Prophylaxis" using "Low Dose Unfractionated Heparin for VTE Prophylaxis (2.16.840.1.113762.1.4.1045.39)")]
	  union [("Medication, Not Ordered: Low Molecular Weight Heparin for VTE Prophylaxis" using "Low Molecular Weight Heparin for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.219)")]
	  union [("Medication, Not Ordered: Injectable Factor Xa Inhibitor for VTE Prophylaxis" using "Injectable Factor Xa Inhibitor for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.211)")]
	  union [("Medication, Not Ordered: Warfarin" using "Warfarin (2.16.840.1.113883.3.117.1.7.1.232)")]
	  union [("Medication, Not Ordered: Rivaroxaban for VTE Prophylaxis" using "Rivaroxaban for VTE Prophylaxis (2.16.840.1.113762.1.4.1110.50)")]
	  union [("Device, Not Applied: Intermittent pneumatic compression devices (IPC)" using "Intermittent pneumatic compression devices (IPC) (2.16.840.1.113883.3.117.1.7.1.214)")]
	  union [("Device, Not Applied: Venous foot pumps (VFP)" using "Venous foot pumps (VFP) (2.16.840.1.113883.3.117.1.7.1.230)")]
	  union [("Device, Not Applied: Graduated compression stockings (GCS)" using "Graduated compression stockings (GCS) (2.16.840.1.113883.3.117.1.7.1.256)")]
	  union [("Device, Not Ordered: Intermittent pneumatic compression devices (IPC)" using "Intermittent pneumatic compression devices (IPC) (2.16.840.1.113883.3.117.1.7.1.214)")]
	  union [("Device, Not Ordered: Venous foot pumps (VFP)" using "Venous foot pumps (VFP) (2.16.840.1.113883.3.117.1.7.1.230)")]
	  union [("Device, Not Ordered: Graduated compression stockings (GCS)" using "Graduated compression stockings (GCS) (2.16.840.1.113883.3.117.1.7.1.256)")] ) NoVTEProphylaxis
	  where NoVTEProphylaxis.negationRationale in (valueset "Patient Refusal" (2.16.840.1.113883.3.117.1.7.1.93)) PatientRefusal
	    such that PatientRefusal.authorDatetime during VTE.FromDayOfStartOfHospitalizationToDayAfterFirstICU ( QualifyingEncounterICU )
	  union from
	  VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU,
	  [("Procedure, Performed: General or Neuraxial Anesthesia" using "General or Neuraxial Anesthesia (2.16.840.1.113883.3.666.5.1743)")] AnesthesiaProcedure,
	  ( [("Medication, Not Administered: Low Dose Unfractionated Heparin for VTE Prophylaxis" using "Low Dose Unfractionated Heparin for VTE Prophylaxis (2.16.840.1.113762.1.4.1045.39)")]
	  union [("Medication, Not Administered: Low Molecular Weight Heparin for VTE Prophylaxis" using "Low Molecular Weight Heparin for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.219)")]
	  union [("Medication, Not Administered: Injectable Factor Xa Inhibitor for VTE Prophylaxis" using "Injectable Factor Xa Inhibitor for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.211)")]
	  union [("Medication, Not Administered: Warfarin" using "Warfarin (2.16.840.1.113883.3.117.1.7.1.232)")]
	  union [("Medication, Not Administered: Rivaroxaban for VTE Prophylaxis" using "Rivaroxaban for VTE Prophylaxis (2.16.840.1.113762.1.4.1110.50)")]
	  union [("Medication, Not Ordered: Low Dose Unfractionated Heparin for VTE Prophylaxis" using "Low Dose Unfractionated Heparin for VTE Prophylaxis (2.16.840.1.113762.1.4.1045.39)")]
	  union [("Medication, Not Ordered: Low Molecular Weight Heparin for VTE Prophylaxis" using "Low Molecular Weight Heparin for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.219)")]
	  union [("Medication, Not Ordered: Injectable Factor Xa Inhibitor for VTE Prophylaxis" using "Injectable Factor Xa Inhibitor for VTE Prophylaxis (2.16.840.1.113883.3.117.1.7.1.211)")]
	  union [("Medication, Not Ordered: Warfarin" using "Warfarin (2.16.840.1.113883.3.117.1.7.1.232)")]
	  union [("Medication, Not Ordered: Rivaroxaban for VTE Prophylaxis" using "Rivaroxaban for VTE Prophylaxis (2.16.840.1.113762.1.4.1110.50)")]
	  union [("Device, Not Applied: Intermittent pneumatic compression devices (IPC)" using "Intermittent pneumatic compression devices (IPC) (2.16.840.1.113883.3.117.1.7.1.214)")]
	  union [("Device, Not Applied: Venous foot pumps (VFP)" using "Venous foot pumps (VFP) (2.16.840.1.113883.3.117.1.7.1.230)")]
	  union [("Device, Not Applied: Graduated compression stockings (GCS)" using "Graduated compression stockings (GCS) (2.16.840.1.113883.3.117.1.7.1.256)")]
	  union [("Device, Not Ordered: Intermittent pneumatic compression devices (IPC)" using "Intermittent pneumatic compression devices (IPC) (2.16.840.1.113883.3.117.1.7.1.214)")]
	  union [("Device, Not Ordered: Venous foot pumps (VFP)" using "Venous foot pumps (VFP) (2.16.840.1.113883.3.117.1.7.1.230)")]
	  union [("Device, Not Ordered: Graduated compression stockings (GCS)" using "Graduated compression stockings (GCS) (2.16.840.1.113883.3.117.1.7.1.256)")] ) NoVTEProphylaxis
	  where NoVTEProphylaxis.negationRationale in (valueset "Patient Refusal" (2.16.840.1.113883.3.117.1.7.1.93)) PatientRefusal
	  where Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) ends 1 day after day of VTE.StartOfFirstICU ( QualifyingEncounterICU )
	    and PatientRefusal.authorDatetime during TJC.CalendarDayOfOrDayAfter ( 
	    end of Global.NormalizeInterval ( AnesthesiaProcedure.relevantDatetime, AnesthesiaProcedure.relevantPeriod ) )
	  return QualifyingEncounterICU
=============================================================================================================================================================================
Numerator Exclusions:
None
=============================================================================================================================================================================
Denominator Exceptions:
VTE.( Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	    with [("Patient Characteristic Birthdate: Birth date" using "Birth date (LOINC Code 21112-8)")] BirthDate
	      such that Global.CalendarAgeInYearsAt ( BirthDate.birthDatetime, start of InpatientEncounter.relevantPeriod ) >= 18
	)
	  intersect Global.[("Encounter, Performed: Encounter Inpatient" using "Encounter Inpatient (2.16.840.1.113883.3.666.5.307)")] EncounterInpatient
	  where LengthInDays(EncounterInpatient.relevantPeriod)<= 120
	    and EncounterInpatient.relevantPeriod ends during day of Measurement Period InpatientEncounter
	  where not ( exists ( InpatientEncounter.diagnoses EncounterDiagnoses
	        where ( EncounterDiagnoses.code in (valueset "Obstetrics" (2.16.840.1.113883.3.117.1.7.1.263))
	            or EncounterDiagnoses.code in (valueset "Venous Thromboembolism" (2.16.840.1.113883.3.117.1.7.1.279))
	            or EncounterDiagnoses.code in (valueset "Obstetrics VTE" (2.16.840.1.113883.3.117.1.7.1.264))
	        )
	    )
	  ) QualifyingEncounter
	  where exists ( QualifyingEncounter.facilityLocations Location
	      where Location.code in (valueset "Intensive Care Unit" (2.16.840.1.113762.1.4.1029.206))
	        and Location.locationPeriod during QualifyingEncounter.relevantPeriod
	  ) QualifyingEncounterICU
	  where Global.LengthInDays ( VTE.FirstICULocationPeriod ( QualifyingEncounterICU ) ) < 1
=============================================================================================================================================================================
Stratification:
None
